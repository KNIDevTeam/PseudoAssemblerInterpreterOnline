var rangeSelectionSaveRestore=function(){var e="â­¾",n=void 0!==window.getSelection().extend;function r(e,n){return(n||document).getElementById(e)}function t(e){e.parentNode.removeChild(e)}function o(e){return"string"==typeof e?/^backward(?:s)?$/i.test(e):!!e}function a(e,r){if(n){var t=r.cloneRange();return t.collapse(!1),e.removeAllRanges(),e.addRange(t),e.extend(r.startContainer,r.startOffset),!0}return e.removeAllRanges(),e.addRange(r),!1}function s(n,r){var t,o="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),a=n.startContainer.ownerDocument,s=n.cloneRange();return s.collapse(r),(t=a.createElement("span")).id=o,t.style.lineHeight="0",t.style.display="none",t.textContent=e,s.insertNode(t),t}function d(e,n,o,a){var s=r(o,e);s?(n[a?"setStartBefore":"setEndBefore"](s),t(s)):module.warn("Marker element has been removed. Cannot restore selection.")}function i(e,n){return n.compareBoundaryPoints(e.START_TO_START,e)}function c(e,n){var r,t=e.startContainer.ownerDocument,a=e.toString();return e.collapsed?{document:t,markerId:(r=s(e,!1)).id,collapsed:!0}:(r=s(e,!1),{document:t,startMarkerId:s(e,!0).id,endMarkerId:r.id,collapsed:!1,backward:o(n),toString:function(){return"original text: '"+a+"', new text: '"+e.toString()+"'"}})}function l(e){var n=e.document;"undefined"==typeof normalize&&(normalize=!0);var o=n.createRange(n);if(e.collapsed){var a=r(e.markerId,n);if(a){a.style.display="inline";var s=a.previousSibling;s&&3==s.nodeType?(t(a),o.setStart(s,s.length),o.collapse(!0)):(o.setEndBefore(a),o.collapse(!1),t(a))}else console.warn("Marker element has been removed. Cannot restore selection.")}else d(n,o,e.startMarkerId,!0),d(n,o,e.endMarkerId,!1);return o}function u(e,n){(e=e.slice(0)).sort(i);for(var t,a,s=o(n),d=e.map(function(e){return c(e,s)}),l=e.length-1;l>=0;--l)a=(t=e[l]).startContainer.ownerDocument,t.collapsed?(t.setStartAfter(r(d[l].markerId,a)),t.collapse(!0)):(t.setEndBefore(r(d[l].endMarkerId,a)),t.setStartAfter(r(d[l].startMarkerId,a)));return d}function f(e){for(var n=[],r=e.length-1;r>=0;r--)n[r]=l(e[r]);return n}function g(e,n){var o=r(n,e);o&&t(o)}return{saveRange:c,restoreRange:l,saveRanges:u,restoreRanges:f,saveSelection:function(e){for(var n=(e=e||window).getSelection(),r=[],t=0;t<n.rangeCount;++t)r.push(n.getRangeAt(t));var o=1==r.length&&function(e){var n=!1;if(!e.isCollapsed){var r=document.createRange();r.setStart(e.anchorNode,e.anchorOffset),r.setEnd(e.focusNode,e.focusOffset),n=r.collapsed}return n}(n),s=u(r,o);return n.removeAllRanges(),o?a(n,r[0]):r.forEach(function(e){n.addRange(e)}),{win:e,rangeInfos:s,restored:!1}},restoreSelection:function(e,r){if(!e.restored){var t=e.rangeInfos,o=e.win.getSelection(),s=f(t),d=t.length;o.removeAllRanges(),1==d&&r&&n&&t[0].backward?a(o,s[0]):s.forEach(function(e){o.addRange(e)}),e.restored=!0}},removeMarkerElement:g,removeMarkers:function(e){e.rangeInfos.forEach(function(n){n.collapsed?g(e.doc,n.markerId):(g(e.doc,n.startMarkerId),g(e.doc,n.endMarkerId))})}}}();